# Текущие задачи

## 1. БЭКЕНД – ОСНОВА (Слава) ~3 недели

### Backend-Core
1. [x] Создать структуру проекта FastAPI.
2. [ ] Настроить `.env`, конфигурации и CORS.
3. [x] Подключить Postgres и SQLAlchemy (async).
4. [x] Настроить Alembic (миграции).
5. [x] Написать Dockerfile для backend и docker-compose.

---

## 2. АВТОРИЗАЦИЯ (Слава + Яна) ~3 недели

### Auth
6. [x] Создать модель User в БД.
7. [ ] Реализовать хеширование паролей.
8. [ ] Реализовать JWT-авторизацию.
9. [ ] Эндпоинт `POST /auth/register` — регистрация.
10. [ ] Эндпоинт `POST /auth/login` — логин.
11. [ ] Эндпоинт `GET /auth/me` — получение профиля.
12. [ ] Написать тесты на авторизацию.

---

## 3. ЛОББИ И СТОЛЫ (REST) (Сергей) ~1 неделя

### Tables
13. [x] Создать модель Table (стол).
14. [?] Создать модель Seat (место игрока).
15. [x] Эндпоинт `GET /tables` — список столов.
16. [x] Эндпоинт `POST /tables/create` — создание стола.
17. [x] Эндпоинт `GET /tables/{id}` — инфо стола.
18. [x] Эндпоинт `POST /tables/{id}/join` — сесть за стол.
19. [x] Эндпоинт `POST /tables/{id}/leave` — покинуть стол.
20. [x] Эндпоинт `POST /tables/{id}/spectate` — наблюдение.
21. [ ] Тесты для лобби/столов.

---

## 4. ПОКЕРНЫЙ ДВИЖОК (ENGINE) (Никита + Сергей) ~1 неделя

### Core Engine
22. [x] Создать класс Card + enum Rank/Suit.
23. [x] Создать класс Deck (shuffle, draw, draw_many).
24. [x] Создать класс PlayerState (stack, карты, статус).
25. [x] Создать класс GameState (фаза, банк, борд, игроки).
26. [x] Реализовать переходы фаз (preflop → river → showdown).
27. [x] Реализовать действия fold/check/call/bet/raise.
28. [x] Реализовать HandEvaluator (оценка комбинаций).
29. [x] Реализовать определение победителей.
30. [x] Написать юнит-тесты на комбинации.
31. [x] Написать юнит-тесты на игровой сценарий.

---

## 5. GAME SERVICE (СЕРВИСНАЯ ЛОГИКА ИГРЫ) (Яна) ~1 неделя

### GameService
32. [ ] Реализовать сериализацию GameState в JSON.
33. [ ] Реализовать десериализацию GameState из JSON.
34. [ ] Функция “start_hand(table_id)” — запуск раздачи.
35. [ ] Функция “apply_action(table_id, user_id, action)” — игровой ход.
36. [ ] Обновление pot, стека и текущей ставки.
37. [ ] Закрытие раздачи и подсчёт победителей.
38. [ ] Запись FinishedHand и PlayerInHand в БД.
39. [ ] Обновление статистики игрока.
40. [ ] Функция “get_current_state(table_id)”.

---

## 6. WEBSOCKET (Денис) ~2 недели

### WebSocket API
41. [ ] Реализовать эндпоинт `/ws/tables/{id}`.
42. [ ] Реализовать чтение JWT из query-параметра.
43. [ ] Реализовать TableConnection (данные по подключению).
44. [ ] Реализовать ConnectionManager (регистрация/удаление подключений).
45. [ ] Обработка `player_action` (fold/call/check/raise).
46. [ ] Обработка `toggle_show_all` (зрительский режим).
47. [ ] Рассылка состояния через WS (`table_state`).
48. [ ] Реализовать фильтрацию карт по пользователю.
49. [ ] Прописать структуру формата сообщений WS.

---

## 7. СТАТИСТИКА (Никита) ~1 неделя

### Stats
50. [x] Создать модель PlayerStats.
51. [x] Реализовать функцию обновления статы после раздачи.
52. [ ] Эндпоинт `/stats/me/stats`.
53. [ ] Эндпоинт `/stats/me/history`.
54. [ ] Эндпоинт `/stats/{user_id}/stats`.
55. [ ] Эндпоинт `/stats/{user_id}/history`.
56. [ ] Тесты статистики.

---

## 8. ФРОНТЕНД (Денис) ~2 недели

### Frontend
57. [x] Инициализировать проект React + Vite + TS.
58. [ ] Реализовать страницу Login/Register.
59. [ ] Реализовать страницу Lobby (список столов).
60. [ ] Реализовать страницу Table (игровой стол).
61. [ ] Реализовать отображение борда, игроков, банка.
62. [ ] Реализовать кнопки действий Fold/Call/Check/Raise.
63. [ ] Интегрировать WebSocket (подключение + обновление состояния).
64. [ ] Реализовать режим Spectator + переключатель “Показывать карты”.
65. [ ] Реализовать страницу Profile (статы + история).

---

## 9. ДОКУМЕНТАЦИЯ (Все вместе) ~4 недели

### Docs
66. [ ] Написать архитектурную диаграмму.
67. [ ] Написать диаграмму взаимодействия WebSocket.
68. [ ] Нарисовать ER-диаграмму БД.
69. [ ] Описание API (REST + WS).
70. [ ] Финальное описание проекта для защиты.


# Документация проекта

## Backend

-### Запуск (локально)
    - из корня репозитория: `poetry install` затем `poetry run uvicorn backend.rest_api.main:app --reload --host 0.0.0.0 --port 8000`

- ### Docker

    - uvicorn

    - poetry

    - dependecies

- ### Api (FastApi)

    - **Auth** */auth* - авторизация пользователей

        - POST */register* - регистрация (email, login, password+hash) + присванивание jwt

        - POST */login* - логин (email/login, password)

        - GET */me* - профиль текущего пользователя

    - **Lobbies** */tables* - столы, игры

        - GET *default* - список столов

        - POST */create* - создать стол с определёнными настройками (max_players: int, private: bool, buy_in: int)

        - GET */{uuid}* - информация стола по uuid

        - POST */{uuid}/join* - создание места за столом

        - POST */{uuid}/leave* - освобождение места, возврат средств игроку

        - POST */{uuid}/spectate* - сидеть в роли наблюдателя

    - **Stats** */stats* - статистика пользователей

        - GET */me/history* - прошедшие игры текущего пользователя

        - GET */{user_id}/history* - прошедшие игры пользователя по user_id

        - GET */me/stats* - статистика за все игры текущего пользователя

        - GET */{user_id}/stats* - статистика за все игры пользователя по user_id

- ### Poker Engine

    - Класс **Card** - карта

        - *Rank: str* - ранг 2-10, Валет Jack, Дама Queen, Король King, Туз Ace

        - *Suit: str* - масть Черви Hearts, Пики Spades, Бубны Diamonds, Трефы Clubs

    - Класс **Deck** - набор карт

        - *shuffle(): None* - перемешать все карты

        - *draw(): Card* - взять карту
    
    - Класс **Table** - стол, за которым идёт игра

        - *uuid: int* - айди стола

        - *max_players: int* - максимальное кол-во игроков

        - *buy_in: int* - за сколько садимся за стол

        - *private: bool* - приватный стол или можно ли присоединиться к столу из лобби

        - *players: List[int]* - список айди игроков стола

        - *spectators: List[int]* - список айди наблюдателей стола

    - Класс **PlayerState** - состояние игрока

        - *user_id: int* - айди пользоваетеля

        - *position: int* - позиция игрока за столом

        - *stack: int* - баланс фишек

        - *hole_cards: List[Card]* - выданные карты

        - *bet: int* - ставка

        - *status: Enum* - статус игрока, т.е. spectator/active/folded/all-in

        - *fold(): None* - сбросить карты

        - *check(): None* - пропуск хода

        - *call(): None* - поставить такую же ставку, как и у наибольшего игрока

        - *raise(amount): None* - повысить ставку

        - *is_first_to_play(): bool* - проверить первый ли ставил ставку для определения конца раунда

        - *is_small_blind(): bool* - small blind?

        - *is_big_blind(): bool* - big blind?

    - Класс **GameState** - состояние раздачи

        - *players: List[PlayerState]* - список игроков

        - *status: Enum* - фаза preflop/flop/turn/river/showdown

        - *board: List[Cards]* - выложенные карты

        - *pot: int* - суммарный банк

        - *min_bet: int* - минимальная ставка

        - *cur_bet: int* - текущая ставка, которую нужно уравнять ставка

        - *cur_player: PlayerState* - ход игрока

        - *raised_bet: int* - количество поднятий ставок

        - *next_player(): PlayerState* - отдать ход следующему игроку

        - *is_everyone_played(): bool* - проверить все ли походили и все ли поставили необходимую ставку

        - *is_check(): bool* - можно ли чекать

        - *is_ready_for_next_phase(): bool* - проверить готова ли игра к следующей фазе

        - возможно нужно будет хранить список ставок и действий

    - Класс **HandEvaluator** - определение руки

        - *board: List[Cards]* - карты на столе

        - *hole_cards: List[Cards]* - карты игрока
    
    - Класс определение победителя хз надо додумать

- ### Database (SqlAlchemy, Postgres)

    - **User** - пользователь, для авторизации

        - *user_id: int* - айди пользователя

        - *username: str* - имя пользователя

        - *email: str* - почта

        - *password_hash: str* - хэш пароля

        - *balance: int* - баланс

        - *created_at: datetime* - время создания

    - **PlayerStats** - статистика игрока за все игры определённого игрока

        - *hands_won: int* - выигранные игры

        - *hands_lost: int* - проигранные игры

        - *max_balance: int* - максимальный баланс за всё время

        - *max_bet: int* - максимальная ставка за всё время

        - *lost_stack* - суммарные потерянные фишки

        - *won_stack* - суммарные выигранные фишки 

    - **PlayerGame** - статистика игрока за игру

        - *id: int* - айди игрока (типо айди PlayerGame)

        - *table_id: int* - айди стола

        - *user_id: int* - айди пользователя

        - *hole_cards: List[str]* - выданные карты

        - *bet: int* - ставка

    - **FinishedGame** - законченные игры

        - *uuid: int* - айди игры

        - *Winners: List[User]* - победители

        - *Pot: int* - суммарные ставки

        - *Board: List[str]* - карты на столе в конце игры

        - *Players: List[PlayerGame]* - игроки

- ### Тесты всего всего всего

- ### Websocket

    дай бог разобраться с этим

## Frontend

Vite + React + TypeScript + Node.js

- ### Страницы:

    - **Login/Register** - регистрация/логин

    - **Lobby** - список столов

    - **Table** - стол, вокруг которого сидят игроки

    - **Profile** - профиль игрока

Впервые пользователь при входе видит страницу Login/Register

После успешной регистрации/логина пользователь видит Лобби. В лобби находятся активные столы, к которым он может присоединиться. Также может создать свой стол со своими настройками. 

Также пользователь может посмотреть на свой профиль, где будут отображаться история игр и его статистика за всё время.

Во время игры пользователь может нажимать разные кнопки будь, то поставить ставку, чекнуть, сдать карты и тп, всё по правилам покера

![](./imgs/table.svg)
